## Транспортный слой

В разделе "Протокол" были определены правила и соглашения, которые позволяют компонентам общаться и понимать друг друга.
Теперь настало время поговорить о том, как компоненты вообще могут общаться друг с другом.

### Паттерны общения

Общение между различными компонентами и частями MoniQue можно описать всего с помощью нескольких паттернов (шаблонов).
Они были заимствованы из системы очередей [ZeroMQ](http://zeromq.org/), поверх которой на данный момент устроена MoniQue.
Коротко дадим описание этих шаблонов с примерами.
Для каждого шаблона будет дана ссылка на соответствующее место в документации ZeroMQ, где любопытный читатель сможет найти для себя реализацию этих методов на многих языках программирования.

#### "Один ко всем" ([PUB-SUB](http://zguide.zeromq.org/page:all#Getting-the-Message-Out))

С одной стороны есть тот, кто вещает (публикует, англ. publish) какую-либо информацию.
С другой стороны есть тот, кто принимает (подписывается на, англ. subscribe) эту информацию.

Такой тип общения можно легко представлять себе как радиостанцию.
Радиостанция рассылает информацию.
Любой, кто знает радиочастоту, может получить эту информацию.
В MoniQue роль радиочастоты исполняют хост и порт того, кто рассылает сообщения.

> На текущий момент в MoniQue такая схема используется только между "одним местом" (Scheduler) и компонентами, которые, зная хост и порт одного места, могут получать от него информацию.

#### "Один к одному" ([PUSH-PULL](http://zguide.zeromq.org/page:all#Divide-and-Conquer))

Шаблон PUSH-PULL может использоваться в друх вариантах.
Вариант "один к одному" предназначен вот для чего.
Рассылает (толкает, англ. push) информацию в какой-то хост и порт по-прежнему кто-то один.
Слушать этот хост и порт могут несколько компонентов, но при этом сообщение будет отдано только тому компоненту, который успел забрать его раньше других.

Этот шаблон можно ассоциировать с выражением "кто первый встал, того и тапки".
Он применяется в том случае, если нужно распределить сообщения между теми, кто принимает сообщения.

> На текущий момент данный шаблон используется в [контроллере](Controller.md), который распределяет задачи между однотипными компонентами, а также во внутренностях Scheduler.

#### "Все в один" ([PUSH-PULL](http://zguide.zeromq.org/page:all#Divide-and-Conquer))

Второй вариант PUSH-PULL противоположен первому.
Его суть в том, что много отправителей могут отсылать сообщения кому-то одному, кто умеет все эти сообщения "собирать".

Аналогией этому шаблону может служить почтовый ящик, в который любой человек может затолкнуть письмо (push), и который не отказывает никому и затягивает (pull) все письма.

> На текущий момент данный шаблон используется между компонентами, которые отсылают сообщения, и "одним местом", которое эти сообщения принимает.
> Внутренности Scheduler используют и этот шаблон тоже.

