## Введение

MoniQue (Monitored Queue, MQ) - инфраструктурная разработка компании BIOCAD.

> Терминология: под сервисом или компонентом понимается разработанный и запущенный программный продукт, который умеет выполнять какую-либо функцию.
> Под системой мы будем подразумевать как модули MoniQue, так и все компоненты/сервисы, которые имеют к ней отношение или используют её для своих целей.

Цели, которые стоят перед данной системой:
  1. предоставить возможность различным сервисам "общаться" между собой;
  2. повысить переиспользование разработанных сервисов.
  
Что понимается под "общением"?
Различные сервисы могут быть заинтересованы в данных, которые порождаются другими сервисами.
А значит, им нужно эти данные получить или отправить.
Именно это мы и понимаем под "общением" между компонентами системы.
При этом порождать данные могут не только люди (посредством сервисов), но и алгоритмы, датчики, и так далее.
  
Задачи, которые решает MoniQue:
  1. предоставляет "единое место", через которое происходит общение компонентов между собой;
  2. предоставляет протокол, придерживаясь которого один компонент всегда поймёт другой компонент;
  3. порождает и поддерживает порядок на документацию, с помощью которой повышается понимание того, что происходит в системе.
  
А теперь поговорим подробнее про каждый пункт.

### Единое место

Оно же Scheduler, планировщик. 
Для чего же оно нужно?
Представим, что компонент `A` решил запросить у компонента `B` какую-то информацию.
Значит ему нужно знать не только то, что он хочет запросить, но и то, где располагается компонент `B`.
Несложно догадаться, что для этого необходимо знать хост и порт, на котором работает компонент `B`.
А что, если компонент `B` настолько популярен, что его информацию хотят использовать и компоненты от `C` до `Z`?
Может случиться так, что и компонент `A` тоже популярен, поэтому про его местонахождение также будут знать компоненты от `C` до `Z`.
Понятно, что при таком подходе в самом худшем случае на `n` компонентов в системе будет `n*(n-1)/2` связей между ними.
Это очень много (к примеру, если есть 50 компонентов, то связей в худшем случае будет 1225).

Поэтому мы решили пойти немного другим путём.
А именно - через одно место.
Что оно из себя представляет?
В первом приближении (подробности будут описаны ниже) оно умеет делать простую операцию: принимать сообщения ото всех и всем же его рассылать.
Его можно сравнить с невнимательной девушкой: в одно ухо информация влетает, через другое вылетает.
Условимся, что влетает через левое ухо, вылетает через правое.
И любой компонент в системе знает про эти два уха.
Если компонент `A` решил запросить информацию от компонента `B`, он должен сформировать соответствующее сообщение.
Но посылает его не напрямую в компонент `B`, а отсылает в левое ухо центрального места.
Центральное место перекладывает сообщение в правое ухо и рассылает всем.
Если в этот момент компонент `B` слушал правое ухо, к нему придёт сообщение, которое отослал компонент `A`.

Таким образом, любое общение между компонентами осуществляется посредством одного места.
И всё, что для этого нужно знать любому компоненту - только то, куда сообщение отослать (левое ухо) и откуда сообщение можно получить (правое ухо).
Вот для этого и существует центральное место.

### Протокол

Отлично, мы решили проблему большого количества связей между компонентами.
Но это не решает той проблемы, что компонентам нужно уметь понимать то, что придёт от другого компонента.
Для решения этой проблемы был разработан и реализован единый протокол общения.
Если компонент его придерживается, то любой другой компонент в системе сможет понять, что именно он хотел сказать или спросить.

### Порядок

Превосходно, мы научили компоненты общаться друг с другом, да и ещё в определённом формате.
Но это хорошо работает до того момента, пока компоненты разрабатывает один человек, который может упомнить (хотя и скоро забудет) все те сообщения, которые умеют обрабатывать или отсылать его компоненты.
Ясное дело, такой подход не ведёт к переиспользуемости сервисов внутри системы.
Для решения этой проблемы были сформулированы и описаны (ниже) правила, по которым в системе заводится компонент и сообщение.
Любой компонент и сообщение должны быть задокументированы, чтобы можно было разобраться в том, какие сообщения проходят внутри системы, а также какие компоненты их обрабатывают.

### Резюмируя

Система MoniQue, решая на поставленные перед нею задачи, отвечает на следующие три вопроса:
  1. **где** то место, через которое происходит общение? (одно место)
  2. **что** нужно отослать, чтобы тебя поняли? (сообщение в фиксированном формате)
  3. **как** нужно подходить к разработке новых компонентов? (документируя)


